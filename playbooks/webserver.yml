---
- name: Web Server Configuration
  hosts: webservers
  become: true
  gather_facts: true

  vars:
    apache_pkg: "{{ 'apache2' if ansible_facts.os_family == 'Debian' else 'httpd' }}"
    apache_svc: "{{ 'apache2' if ansible_facts.os_family == 'Debian' else 'httpd' }}"

  tasks:

    - name: Install Apache web server
      package:
        name: "{{ apache_pkg }}"
        state: present
        update_cache: yes
      check_mode: no

    - name: Start and enable Apache service
      service:
        name: "{{ apache_svc }}"
        state: started
        enabled: true
      when: not ansible_check_mode

    - name: Deploy default index page
      copy:
        dest: /var/www/html/index.html
        content: |
          <html>
          <head>
            <title>Apache Web Server</title>
          </head>
          <body>
            <h1>Welcome to {{ inventory_hostname }}</h1>
            <p>Managed by Ansible Automation Platform 2.4</p>
          </body>
          </html>
        mode: '0644'
      when: not ansible_check_mode

    - name: Verify Apache package presence (check mode friendly)
      package_facts:
        manager: auto

    - name: Show Apache install status
      debug:
        msg: >
          Apache package {{ apache_pkg }}
          is {{ 'installed' if apache_pkg in ansible_facts.packages else 'NOT installed' }}
